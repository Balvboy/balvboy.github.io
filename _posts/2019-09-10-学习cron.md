---
layout: post
title: cron学习笔记
date: 2019-09-10 12:58
category: cron
author: zhouyang
catalog: true
tags: [cron]
summary: cron笔记
---

# cron介绍
> crontab命令常见于Unix和类Unix的操作系统之中，用于设置周期性被执行的指令。该命令从标准输入设备读取指令，并将其存放于“crontab”文件中，以供之后读取和执行。该词来源于希腊语chronos(χρόνος)，原意是时间。
> 通常，crontab储存的指令被守护进程激活，crond常常在后台运行，每一分钟检查是否有预定的作业需要执行。这类作业一般称为cron jobs。
我理解cron是一个表达式，用来表示一个任务的周期性执行时间。

# cron格式
在开发的过程中，我们会遇到两种cron表达式的格式，Java的和Linux，他们有在格式上有一点区别；

首先最明显的区别是
- Linux 不支持秒和年，这两个级别的设置。而Java是支持的

除此之外还有一点非常蛋疼的区别就是他们对于day-of-week字段中数字的定义不同。
我们在下面单独说

## Java中的格式
```
┌─秒(0-59)
| ┌─分鐘(0-59)
| │ ┌─小時(0-23)
| | │ ┌─日 day of month(1-31)
| | | | ┌─月(1-12)
| | | | | ┌─星期 day of week(0-7，0和7都表示星期日)
| | | | | | ┌─年(可以省略不写)
* * * * * * *
```
## Linux中的格式
```
┌─分鐘（0 - 59）
│ ┌─小時（0 - 23）
| │ ┌─日 day of month(1-31)
| | | ┌─月（1 - 12）
| | | | ┌─星期 day of week(0-7，0和7都表示星期日)
| | | | |
* * * * * 
```

# Day-Of—Week中数字的定义
## Linux
在Linux中，数字0和7都代表周日
|数字|星期|
|----|----|
|0|Sunday|
|1|Monday|
|2|Tuesday|
|3|WEDNESDAY|
|4|THURSDAY|
|5|Friday|
|6|SATURDAY|
|7|Sunday|

## Java
在Java的不同实现中，也各不相同
### 1.Spring的CronSequenceGenerator
Spring实现的`CronSequenceGenerator`中和Linux保持一致；
顺便说一下这个类是Spring中`@Scheduled`注解的默认cron解析类

### 2.Quartz的CronExpression
Quartz的实现`CronExpression`和Linux不同，它不支持0，然后1-7分别是SUN-SAT

|数字|星期|
|----|----|
|1|Sunday|
|2|Monday|
|3|Tuesday|
|4|WEDNESDAY|
|5|THURSDAY|
|6|Friday|
|7|SATURDAY|

## 解决办法
鉴于不同的实现中，对于day of week数字的定义的区别，最好的办法就是使用 星期的简写来代替数字，这样就能保证你的cron不管在哪个Java的cron实现中都能正确运行。

# cron每个字段支持的输入

| Field Name	| 	Allowed Values	 |	Allowed Special Characters|
|--|--|--|
|Seconds	  | 	0-59	     |	, - * /|
|Minutes	  | 	0-59	     | 	, - * /|
|Hours	 	  |     0-23	 	 |  , - * /  |
|Day-of-month | 	1-31	     | 	, - * ? / L W|
|Month	      |	1-12 or JAN-DEC	 |	, - * /|
|Day-of-Week  |	 	0-7 or SUN,MON,TUE,WED,THU,FRI,SAT|	, - * ? / L #|
|Year (Optional)| 	empty, 1970-2199|, - * /|

# cron特殊字符说明
|Special Character| Description |Example| Explain |
|-|--------|---------|---------|
| , |表示几个会生效的值 |1,2,3 in Minutes |表示在第1和第2和第3分钟 都会生效|
| - |表示生效的范围    |1-10 in Minutes |表示在第1到第10分钟会生效|
| * |表示所有的值都会生效， |* in Minutes |表示每分钟都会生效|
| / |表示增量，可以理解为每隔多长时间 |0/30 in Minutes|表示第0分钟生效，然后每隔30分钟生效一次|
| ? |下面单独解释|||
| L |下面单独解释|||
| W |下面单独解释|||


# L字符说明
L其实是LAST的简写，就是最后的意思，它可以用在 day-of-month和day-of-week字段中。
它在两个字段中的意思有一些不同
## **day of month**

在这个字段中，L就表示这个月的最后一天，如果是1月那就是31号，如果是平年的2月，那就是28号

## **day of week**
在day-of-week这个字段中，如果直接使用L,则表示星期六（是从周日开始的，所以周六是最后一天）



# W字符说明

# ?字符说明
'?'放在最后来说，这个也是我平时我使用很多，但是一直没有搞明白的一个字符。
> The '?' character is allowed for the day-of-month and day-of-week fields. It is used to specify 'no specific value'. This is useful when you need to specify something in one of the two fields, but not the other.

> ?号只能用在day-of-month和day-of-week字段中。通常用来表示为'没有指定的值'。当你需要在两个字段之一中指定某些内容而不是另一个字段时，这非常有用。

我们使用cron的初衷是想让这个任务定期的执行，比如每个月1日执行什么，或者每周1执行什么。当一个任务在每个月1日，执行的时候，我们通常不会要求它是星期几，同样每周1执行的任务，我们也不会关心当天是几月几号。也就是说，在极大多数的情况下，我们不需要这两个字段同时满足。

`所以说，通常情况下，我们在指定了这两个其中一个字段之后，会把另一个字段设置为'?'。`

或许有人说，我就要每个月1号、并且还必须得是星期一的0点0分0秒，它才能执行，当然我们也能实现
```
0 0 0 1 * 1

接下来7次的执行时间
--------------------------
2020-06-01 00:00:00
2021-02-01 00:00:00
2021-03-01 00:00:00
2021-11-01 00:00:00
2022-08-01 00:00:00
2023-05-01 00:00:00
2024-01-01 00:00:00
```
那这个时间真的是你想要的吗？


